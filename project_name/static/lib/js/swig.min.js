/*! Swig https://paularmstrong.github.com/swig | https://github.com/paularmstrong/swig/blob/master/LICENSE *//*! Cross-Browser Split 1.0.1 (c) Steven Levithan <stevenlevithan.com>; MIT License An ECMA-compliant, uniform cross-browser split method *//*! Underscore.js (c) 2011 Jeremy Ashkenas | https://github.com/documentcloud/underscore/blob/master/LICENSE *//*! DateZ (c) 2011 Tomo Universalis | https://github.com/TomoUniversalis/DateZ/blob/master/LISENCE */(function(){var e="{{ a }}",t;e.split(/(\{\{.*?\}\})/).length===0&&(t=function(e,n,r){function c(){var e=1;for(e;e<arguments.length-2;e+=1)arguments[e]===undefined&&(a[e]=undefined)}if(Object.prototype.toString.call(n)!=="[object RegExp]")return t._nativeSplit.call(e,n,r);var i=[],s=0,o=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.sticky?"y":""),u,a,f,l;n=RegExp(n.source,o+"g"),e=e.toString(),t._compliantExecNpcg||(u=RegExp("^"+n.source+"$(?!\\s)",o));if(r===undefined||r<0)r=Infinity;else{r=Math.floor(+r);if(!r)return[]}a=n.exec(e);while(a){f=a.index+a[0].length;if(f>s){i.push(e.slice(s,a.index)),!t._compliantExecNpcg&&a.length>1&&a[0].replace(u,c),a.length>1&&a.index<e.length&&Array.prototype.push.apply(i,a.slice(1)),l=a[0].length,s=f;if(i.length>=r)break}n.lastIndex===a.index&&(n.lastIndex+=1),a=n.exec(e)}return s===e.length?(l||!n.test(""))&&i.push(""):i.push(e.slice(s)),i.length>r?i.slice(0,r):i},t._compliantExecNpcg=/()??/.exec("")[1]===undefined,t._nativeSplit=String.prototype.split,String.prototype.split=function(e,n){return t(this,e,n)})})(),swig=function(){var e={},t={},n={},r={},i={},s={};return function(e){function a(e){return{render:function(){return"<pre>"+e.stack+"</pre>"}}}function f(e){return new Function("_context","_parents","_filters","_","_ext",["_parents = _parents ? _parents.slice() : [];","_context = _context || {};","var j = _parents.length,",'  _output = "",',"  _this = this;","while (j--) {","   if (_parents[j] === this.id) {",'     return "Circular import of template " + this.id + " in " + _parents[_parents.length-1];',"   }","}","_parents.push(this.id);",e,"return _output;"].join(""))}function l(t,n){var r={compileFile:e.compileFile,blocks:{},type:i.TEMPLATE,id:n},s,u,l;if(o.allowErrors)s=i.parse.call(r,t,o.tags,o.autoescape);else try{s=i.parse.call(r,t,o.tags,o.autoescape)}catch(c){return new a(c)}return r.tokens=s,u=i.compile.call(r),u!==!1?l=f(u):l=function(e,t,n,o,a){r.tokens=s,u=i.compile.call(r,"",e);var l=f(u);return l.call(this,e,t,n,o,a)},r.render=function(e,t){if(o.allowErrors)return l.call(this,e,t,o.filters,_,o.extensions);try{return l.call(this,e,t,o.filters,_,o.extensions)}catch(n){return new a(n)}},r}function c(e,t){var n=t.filename||e;return o.cache||t.cache?(u.hasOwnProperty(n)||(u[n]=l(e,n)),u[n]):l(e,n)}var r={allowErrors:!1,autoescape:!0,cache:!0,encoding:"utf8",filters:n,root:"/",tags:s,extensions:{},tzOffset:0},o=_.extend({},r),u={};e.init=function(e){u={},o=_.extend({},r,e),o.filters=_.extend(n,e.filters),o.tags=_.extend(s,e.tags),t.defaultTZOffset=o.tzOffset},e.compileFile=function(e,t){var n,i;if(o.cache&&u.hasOwnProperty(e))return u[e];if(typeof window!="undefined")throw new a({stack:"You must pre-compile all templates in-browser. Use `swig.compile(template);`."});i=function(){var t=/^\//.test(e)||/^.:/.test(e)?e:o.root+"/"+e,i=fs.readFileSync(t,r.encoding);n=c(i,{filename:e})};if(o.allowErrors||t)i();else try{i()}catch(s){n=new a(s)}return n},e.compile=function(e,t){t=t||{};var n=c(e,t||{});return function(e,t){return n.render(e,t)}}}(e),function(e){function r(e){return e.replace(/^\s+|\s+$/g,"")}function s(e){var t=[],n="",r=0;for(r;r<e.length;r+=1){if(!(!e[r]||e[r].charAt(0)===e[r].charAt(e[r].length-1)||e[r].indexOf('"')!==0&&e[r].indexOf("'")!==0)){n=e[r];continue}if(e[r]==="."&&n){n+=".";continue}e[r].indexOf('"')===e[r].length-1||e[r].indexOf("'")===e[r].length-1?(n+=e[r],t.push(n),n=""):t.push(e[r])}return _.compact(t)}function o(t,n){if(_.isArray(t))return"(true)";t=t.replace(/^this/,"_this.__currentContext");if(e.isLiteral(t))return"(true)";var r=t.split(/(\.|\[|\])/),i="",o=[],u=!1,a=!1;return typeof n=="string"&&n.length&&r.unshift(n),r=_.reject(r,function(e){return e===""}),r=s(r),_.each(r,function(t){if(t==="."){a=!0;return}if(t==="["){u=!0;return}if(t==="]"){u=!1;return}if(!i)i=t;else if(u)if(!e.isStringLiteral(t)){if(a){o[o.length-1]=_.last(o).replace(/\] !== "undefined"$/,"_"+t+'] !== "undefined"'),i=i.replace(/\]$/,"_"+t+"]");return}i+="[___"+t+"]"}else i+="["+t+"]";else i+="."+t;a=!1,o.push("typeof "+i+' !== "undefined"')}),"("+o.join(" && ")+")"}var t=/^(Array|ArrayBuffer|Boolean|Date|Error|eval|EvalError|Function|Infinity|Iterator|JSON|Math|Namespace|NaN|Number|Object|QName|RangeError|ReferenceError|RegExp|StopIteration|String|SyntaxError|TypeError|undefined|uneval|URIError|XML|XMLList|break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|with)(?=(\.|$))/;e.isStringLiteral=function(e){if(typeof e!="string")return!1;var t=e.substring(0,1),n=e.charAt(e.length-1,1),r;if(t===n&&(t==="'"||t==='"')){r=e.substr(1,e.length-2).split("").reverse().join("");if(t==="'"&&/'(?!\\)/.test(r)||n==='"'&&/"(?!\\)/.test(r))throw new Error("Invalid string literal. Unescaped quote ("+e[0]+") found.");return!0}return!1},e.isLiteral=function(t){var n=!1;return/^\d+([.]\d+)?$/.test(t)?n=!0:e.isStringLiteral(t)&&(n=!0),n},e.isValidName=function(e){return typeof e=="string"&&e.substr(0,2)!=="__"&&/^([$A-Za-z_]+[$A-Za-z_0-9]*)(\.?([$A-Za-z_]+[$A-Za-z_0-9]*))*$/.test(e)&&!t.test(e)},e.isValidShortName=function(e){return e.substr(0,2)!=="__"&&/^[$A-Za-z_]+[$A-Za-z_0-9]*$/.test(e)&&!t.test(e)},e.isValidBlockName=function(e){return/^[A-Za-z]+[A-Za-z_0-9]*$/.test(e)},e.stripWhitespace=r,e.check=o,e.escapeVarName=function(t,n){if(_.isArray(t))return _.each(t,function(r,i){t[i]=e.escapeVarName(r,n)}),t;t=t.replace(/^this/,"_this.__currentContext");if(e.isLiteral(t))return t;typeof n=="string"&&n.length&&(t=n+"."+t);var r="",i=t.split(/(\.|\[|\])/),o=!1,u=!1;return i=_.reject(i,function(e){return e===""}),i=s(i),_.each(i,function(t){if(t==="."){u=!0;return}if(t==="["){o=!0;return}if(t==="]"){o=!1;return}r?o?e.isStringLiteral(t)?r+="["+t+"]":u?r=r.replace(/\]$/,"_"+t+"]"):r+="[___"+t+"]":r+="."+t:r=t,u=!1}),r},e.wrapMethod=function(t,n,r){var s="(function () {\n",o;return t=t||'""',n?(o=n.args.split(","),o=_.map(o,function(t){var n,r=t.replace(/^\s+|\s+$/g,"");try{n="__"+i.parseVariable(r).name.replace(/\W/g,"_")}catch(o){return t}return e.isValidName(r)?(s+=e.setVar(n,i.parseVariable(r)),n):t}),o=o&&o.length?o.join(","):'""',s+="return ",s+=r?r+'["':"",s+=n.name,s+=r?'"]':"",s+=".call(this",s+=o.length?", "+o:"",s+=");\n",s+"})()"):t},e.wrapFilter=function(t,r){var i="",s="";t=t||'""';if(!r)return t;if(!n.hasOwnProperty(r.name))throw new Error('Filter "'+r.name+'" not found');return s=r.args?t+", "+r.args:t,i+=e.wrapMethod(t,{name:r.name,args:s},"_filters"),i},e.wrapFilters=function(t,n,r,i){var s=e.escapeVarName(t,r);return n&&n.length>0&&_.each(n,function(t){switch(t.name){case"raw":i=!1;return;case"e":case"escape":i=t.args||i;return;default:s=e.wrapFilter(s,t,"_filters")}}),s=s||'""',i&&(s="_filters.escape.call(this, "+s+", "+i+")"),s},e.setVar=function(t,n){var r="",i,s,u;return/\[/.test(n.name)&&(i=n.name.split(/(\[|\])/),s=[],u=!1,_.each(i,function(t){if(t==="")return;if(t==="["){u=!0;return}if(t==="]"){u=!1;return}u&&!e.isStringLiteral(t)&&(r+=e.setVar("___"+t.replace(/\W/g,"_"),{name:t,filters:[],escape:!0}))})),r+="var "+t+' = "";\n'+"if ("+o(n.name,"_context")+") {\n"+"  "+t+" = "+e.wrapFilters(n.name,n.filters,"_context",n.escape)+";\n"+"} else if ("+o(n.name)+") {\n"+"  "+t+" = "+e.wrapFilters(n.name,n.filters,null,n.escape)+";\n"+"}\n",n.filters.length&&(r+=" else if (true) {\n",r+="  "+t+" = "+e.wrapFilters("",n.filters,null,n.escape)+";\n",r+="}\n"),r},e.parseIfArgs=function(t,n){var r=["==","<",">","!=","<=",">=","===","!==","&&","||","in","and","or"],i="Bad if-syntax in `{% if "+t.join(" ")+" %}...",s=[],o,u,a=0;_.each(t,function(t,f){var l=!1,c;/^\(/.test(t)&&(a+=1,t=t.substr(1),s.push({type:"separator",value:"("}));if(/^\![^=]/.test(t)||t==="not")t==="not"?t="":t=t.substr(1),s.push({type:"operator",value:"!"});if(/\)$/.test(t)){if(!a)throw new Error(i);t=t.replace(/\)$/,""),l=!0,a-=1}if(t==="in")u=s.pop(),o="inindex";else if(_.indexOf(r,t)!==-1){if(o==="operator")throw new Error(i);t=t.replace("and","&&").replace("or","||"),s.push({value:t}),o="operator"}else if(t!==""){if(o==="value")throw new Error(i);c=n.parseVariable(t),o==="inindex"?(s.push({preout:u.preout+e.setVar("__op"+f,c),value:"(((_.isArray(__op"+f+") || typeof __op"+f+' === "string") && _.indexOf(__op'+f+", "+u.value+") !== -1) || (typeof __op"+f+' === "object" && '+u.value+" in __op"+f+"))"}),u=null):s.push({preout:e.setVar("__op"+f,c),value:"__op"+f}),o="value"}l&&s.push({type:"separator",value:")"})});if(a>0)throw new Error(i);return s}}(r),function(e){var t={full:["January","February","March","April","May","June","July","August","September","October","November","December"],abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},n={full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],alt:{"-1":"Yesterday",0:"Today",1:"Tomorrow"}};e.defaultTZOffset=0,e.DateZ=function(){function i(e){return e<10?"0"+e:e}function s(){var e=i(Math.floor(Math.abs(n.timezoneOffset)/60)),t=i(Math.abs(n.timezoneOffset)-e*60),r=n.timezoneOffset<0?"+":"-",s=n.tzAbbreviation===undefined?"":" ("+n.tzAbbreviation+")";return"GMT"+r+e+t+s}var t={"default":["getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toISOString","toGMTString","toUTCString","valueOf","getTime"],z:["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getYear","toDateString","toLocaleDateString","toLocaleTimeString"],string:["toLocaleString","toString","toTimeString"],zSet:["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setYear"],set:["setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds"],"static":["UTC","parse"]},n=this,r;n.date=n.dateZ=arguments.length>1?new Date(Date.UTC.apply(Date,arguments)+(new Date).getTimezoneOffset()*6e4):arguments.length===1?new Date(new Date(arguments[0])):new Date,n.timezoneOffset=n.dateZ.getTimezoneOffset(),_.each(t.z,function(e){n[e]=function(){return n.dateZ[e]()}}),_.each(t.string,function(e){n[e]=function(){return n.dateZ[e].apply(n.dateZ,[]).replace(/GMT[+\-]\\d{4} \\(([a-zA-Z]{3,4})\\)/,s())}}),_.each(t["default"],function(e){n[e]=function(){return n.date[e]()}}),_.each(t["static"],function(e){n[e]=function(){return Date[e].apply(Date,arguments)}}),_.each(t.zSet,function(e){n[e]=function(){return n.dateZ[e].apply(n.dateZ,arguments),n.date=new Date(n.dateZ.getTime()-n.dateZ.getTimezoneOffset()*6e4+n.timezoneOffset*6e4),n}}),_.each(t.set,function(e){n[e]=function(){return n.date[e].apply(n.date,arguments),n.dateZ=new Date(n.date.getTime()+n.date.getTimezoneOffset()*6e4-n.timezoneOffset*6e4),n}}),e.defaultTZOffset&&this.setTimezoneOffset(e.defaultTZOffset)},e.DateZ.prototype={getTimezoneOffset:function(){return this.timezoneOffset},setTimezoneOffset:function(e,t){return this.timezoneOffset=e,t&&(this.tzAbbreviation=t),this.dateZ=new Date(this.date.getTime()+this.date.getTimezoneOffset()*6e4-this.timezoneOffset*6e4),this}},e.d=function(e){return(e.getDate()<10?"0":"")+e.getDate()},e.D=function(e){return n.abbr[e.getDay()]},e.j=function(e){return e.getDate()},e.l=function(e){return n.full[e.getDay()]},e.N=function(e){var t=e.getDay();return t>=1?t+1:7},e.S=function(e){var t=e.getDate();return t%10===1&&t!==11?"st":t%10===2&&t!==12?"nd":t%10===3&&t!==13?"rd":"th"},e.w=function(e){return e.getDay()},e.z=function(t,n,r){var i=t.getFullYear(),s=new e.DateZ(i,t.getMonth(),t.getDate(),12,0,0),o=new e.DateZ(i,0,1,12,0,0);return s.setTimezoneOffset(n,r),o.setTimezoneOffset(n,r),Math.round((s-o)/864e5)},e.W=function(e){var t=new Date(e.valueOf()),n=(e.getDay()+6)%7,r;return t.setDate(t.getDate()-n+3),r=t.valueOf(),t.setMonth(0,1),t.getDay()!==4&&t.setMonth(0,1+(4-t.getDay()+7)%7),1+Math.ceil((r-t)/6048e5)},e.F=function(e){return t.full[e.getMonth()]},e.m=function(e){return(e.getMonth()<9?"0":"")+(e.getMonth()+1)},e.M=function(e){return t.abbr[e.getMonth()]},e.n=function(e){return e.getMonth()+1},e.t=function(e){return 32-(new Date(e.getFullYear(),e.getMonth(),32)).getDate()},e.L=function(e){return(new Date(e.getFullYear(),1,29)).getDate()===29},e.o=function(e){var t=new Date(e.valueOf());return t.setDate(t.getDate()-(e.getDay()+6)%7+3),t.getFullYear()},e.Y=function(e){return e.getFullYear()},e.y=function(e){return e.getFullYear().toString().substr(2)},e.a=function(e){return e.getHours()<12?"am":"pm"},e.A=function(e){return e.getHours()<12?"AM":"PM"},e.B=function(e){var t=e.getUTCHours(),n;return t=t===23?0:t+1,n=Math.abs(((t*60+e.getUTCMinutes())*60+e.getUTCSeconds())/86.4).toFixed(0),"000".concat(n).slice(n.length)},e.g=function(e){var t=e.getHours();return t===0?12:t>12?t-12:t},e.G=function(e){return e.getHours()},e.h=function(e){var t=e.getHours();return(t<10||12<t&&22>t?"0":"")+(t<12?t:t-12)},e.H=function(e){var t=e.getHours();return(t<10?"0":"")+t},e.i=function(e){var t=e.getMinutes();return(t<10?"0":"")+t},e.s=function(e){var t=e.getSeconds();return(t<10?"0":"")+t},e.O=function(e){var t=e.getTimezoneOffset();return(t<0?"-":"+")+(t/60<10?"0":"")+t/60+"00"},e.Z=function(e){return e.getTimezoneOffset()*60},e.c=function(e){return e.toISOString()},e.r=function(e){return e.toUTCString()},e.U=function(e){return e.getTime()/1e3}}(t),function(e){e.add=function(e,t){return _.isArray(e)&&_.isArray(t)?e.concat(t):typeof e=="object"&&typeof t=="object"?_.extend(e,t):_.isNumber(e)&&_.isNumber(t)?e+t:e+t},e.addslashes=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.addslashes(n)}),t):t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"')},e.capitalize=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.capitalize(n)}),t):t.toString().charAt(0).toUpperCase()+t.toString().substr(1).toLowerCase()},e.date=function(e,n,r,i){var s=n.length,o=new t.DateZ(e),u,a=0,f="";r&&o.setTimezoneOffset(r,i);for(a;a<s;a+=1)u=n.charAt(a),t.hasOwnProperty(u)?f+=t[u](o,r,i):f+=u;return f},e["default"]=function(e,t){return typeof e=="undefined"||!e&&typeof e!="number"?t:e},e.escape=e.e=function(e,t){t=t||"html";if(typeof e=="string"){if(t==="js"){var n=0,r,i="";e=e.replace(/\\/g,"\\u005C");for(n;n<e.length;n+=1)r=e.charCodeAt(n),r<32?(r=r.toString(16).toUpperCase(),r=r.length<2?"0"+r:r,i+="\\u00"+r):i+=e[n];return i.replace(/&/g,"\\u0026").replace(/</g,"\\u003C").replace(/>/g,"\\u003E").replace(/\'/g,"\\u0027").replace(/"/g,"\\u0022").replace(/\=/g,"\\u003D").replace(/-/g,"\\u002D").replace(/;/g,"\\u003B")}return e.replace(/&(?!amp;|lt;|gt;|quot;|#39;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}return e},e.first=function(e){return typeof e=="object"&&!_.isArray(e)?"":typeof e=="string"?e.substr(0,1):_.first(e)},e.join=function(e,t){if(_.isArray(e))return e.join(t);if(typeof e=="object"){var n=[];return _.each(e,function(e,t){n.push(e)}),n.join(t)}return e},e.json_encode=function(e,t){return JSON.stringify(e,null,t||0)},e.last=function(e){return typeof e=="object"&&!_.isArray(e)?"":typeof e=="string"?e.charAt(e.length-1):_.last(e)},e.length=function(e){return typeof e=="object"?_.keys(e).length:e.length},e.lower=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.lower(n)}),t):t.toString().toLowerCase()},e.replace=function(e,t,n,r){var i=new RegExp(t,r);return e.replace(i,n)},e.reverse=function(e){return _.isArray(e)?e.reverse():e},e.striptags=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.striptags(n)}),t):t.toString().replace(/(<([^>]+)>)/ig,"")},e.title=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.title(n)}),t):t.toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},e.uniq=function(e){return _.uniq(e)},e.upper=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.upper(n)}),t):t.toString().toUpperCase()},e.url_encode=function(e){return encodeURIComponent(e)},e.url_decode=function(e){return decodeURIComponent(e)}}(n),function(e){function a(e){return r.stripWhitespace(e).match(/^[\w\.]+/)[0]}function f(e){return e.replace(/\\/g,"\\\\")}function l(e){return f(r.stripWhitespace(e).replace(/^[\w\.]+\(|\)$/g,""))}function c(e,t){var n=e.split(".");while(n.length)t=t[n.splice(0,1)[0]];return t}function h(e,t){function u(e,n){var r=new RegExp("\\"+n+"$"),i=e,s="";while(!r.test(s)&&i<t.length)s+=" "+t[i],t[i]=null,i+=1;if(!r.test(s))throw new Error("Malformed arguments "+s+" sent to tag.");return s.replace(/^ /,"")}t=_.map(t,f);var n=0,r=t.length,i,s,o=[];for(n;n<r;n+=1){i=t[n];if(i===null||/^\s+$/.test(i))continue;if(/^\"/.test(i)&&!/\"[\]\}]?$/.test(i)||/^\'/.test(i)&&!/\'[\]\}]?$/.test(i)||/^\{/.test(i)&&!/\}$/.test(i)||/^\[/.test(i)&&!/\]$/.test(i)){switch(i.substr(0,1)){case"'":s="'";break;case'"':s='"';break;case"[":s="]";break;case"{":s="}"}o.push(u(n,s));continue}o.push(i)}return o}function p(e,t){_.each(e.tokens,function(e,n){e.name==="block"&&(t[e.args[0]]=e,p(e,t))})}function d(e){var t;return e.parentBlock?t=e.parentBlock:e.parent&&(t=d(_.last(e.parent))),t}function v(e,t){var n,i,u=[];if(this.type===s){_.each(this.tokens,function(e,s){if(!i)if(e.name==="extends"){n=e.args[0];if(!r.isStringLiteral(n)){if(!t){i=!0;return}n='"'+c(n,t)+'"'}if(!r.isStringLiteral(n)||e.args.length>1)throw new Error("Extends tag on line "+e.line+" accepts exactly one string literal as an argument.");if(s>0)throw new Error('Extends tag must be the first tag in the template, but "extends" found on line '+e.line+".");e.template=this.compileFile(n.replace(/['"]/g,""),!0),this.parent=e.template,this.blocks=_.extend({},this.parent.blocks,this.blocks)}else if(e.name==="block"){var a=e.args[0],f;if(!r.isValidBlockName(a)||e.args.length!==1)throw new Error('Invalid block tag name "'+a+'" on line '+e.line+".");this.blocks[a]=e,p(e,this.blocks),this.parent&&(e.parentBlock=this.parent.blocks[a],f=_.indexOf(this.parent.tokens,this.parent.blocks[a]),f>=0&&(this.parent.tokens[f]=e))}else e.type===o&&u.push(e)},this);if(i)return!1;this.parent&&this.parent.tokens&&(this.tokens=u.concat(this.parent.tokens))}}var t=/^\{\{[^\r]*?\}\}$/,n=/^\{%[^\r]*?%\}$/,i=/^\{#[^\r]*?#\}$/,s=e.TEMPLATE=0,o=1,u=2;e.TOKEN_TYPES={TEMPLATE:s,LOGIC:o,VAR:u},e.parseVariable=function(e,t){if(!e)return{type:null,name:"",filters:[],escape:t};var n=[],r=e.replace(/^\{\{\s*|\s*\}\}$/g,"").split("|"),i=r.shift(),s=null,o;return/\(/.test(i)&&(s=l(i.replace(/^\w+\./,"")),i=a(i)),_.each(r,function(e,t){e&&(/^[\w\.]+\(/.test(e)||/\)$/.test(e))&&!/^[\w\.]+\([^\)]*\)$/.test(e)&&(r[t]+=r[t+1]?"|"+r[t+1]:"",r[t+1]=!1)}),r=_.without(r,!1),_.each(r,function(e){var t=a(e);/\(/.test(e)?n.push({name:t,args:l(e)}):n.push({name:t,args:""})}),{type:u,name:i,args:s,filters:n,escape:t}},e.parse=function(s,u,a){var f=r.stripWhitespace(s).split(/(\{%[^\r]*?%\}|\{\{.*?\}\}|\{#[^\r]*?#\})/),l=!!a,c=l,p=[[]],d=0,v=0,m=f.length,g,y,b,w=1,E=1,S=null,x,T=/^\{\% *raw *\%\}/,N=/\{\% *endraw *\%\}$/,C=!1,k=!1,L=!1,A=!1,O=!1;for(v;v<m;v+=1){g=f[v],E=w,S=g.match(/\n/g),k=!1,L=!1,A=!1,O=!1,S&&(w+=S.length);if(C!==!1&&!N.test(g)){C+=g;continue}if(g.length===0||i.test(g))continue;if(/^\s+$/.test(g))g=g.replace(/ +/," ").replace(/\n+/,"\n");else if(t.test(g))g=e.parseVariable(g,l);else if(n.test(g)){if(N.test(g)){g=C+g.replace(N,""),C=!1,p[d].push(g);continue}if(T.test(g)){C=g.replace(T,"");continue}y=g.replace(/^\{%\s*|\s*%\}$/g,"").split(" "),y[0]==="-"&&(L=!0,y.shift()),b=y.shift(),_.last(y)==="-"&&(k=!0,y.pop());if(d>0&&/^end/.test(b)){x=_.last(p[p.length-2]);if("end"+x.name===b){x.name==="autoescape"&&(l=c),x.strip.end=L,x.strip.after=k,p.pop(),d-=1;continue}throw new Error('Expected end tag for "'+x.name+'", but found "'+b+'" at line '+w+".")}if(!u.hasOwnProperty(b))throw new Error("Unknown logic tag at line "+w+': "'+b+'".');b==="autoescape"&&(c=l,l=!y.length||y[0]==="true"?y.length>=2?y[1]:!0:!1),g={type:o,line:E,name:b,compile:u[b],parent:_.uniq(p[p.length-2]||[]),strip:{before:L,after:k,start:!1,end:!1}},g.args=h(g,y);if(u[b].ends){g.strip.after=!1,g.strip.start=k,p[d].push(g),p.push(g.tokens=[]),d+=1;continue}}p[d].push(g)}if(C!==!1)throw new Error('Missing expected end tag for "raw" on line '+E+".");if(d!==0)throw x=_.last(p[p.length-2]),new Error('Missing end tag for "'+x.name+'" that was opened on line '+x.line+".");return p[d]},e.compile=function m(t,n,i){var a="",l,c,h;return t=t||"",this.type===s&&(i=this),this.blocks||(this.blocks={}),v.call(this,t,n)===!1?!1:(_.each(this.tokens,function(s,p){var v,g,y,b,w;if(typeof s=="string")return b=this.tokens[p-1],w=this.tokens[p+1],b&&b.strip&&b.strip.after&&(s=s.replace(/^\s+/,"")),w&&w.strip&&w.strip.before&&(s=s.replace(/\s+$/,"")),a+='_output += "'+f(s).replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/"/g,'\\"')+'";\n',a;if(typeof s!="object")return;s.type===u&&(v=s.name.replace(/\W/g,"_"),g=r.isLiteral(v)?'["'+v+'"]':"."+v,y=s.args&&s.args.length?s.args:"",a+='if (typeof _context !== "undefined" && typeof _context'+g+' === "function") {\n',l=r.wrapMethod("",{name:v,args:y},"_context"),a+='  _output = (typeof _output === "undefined") ? '+l+": _output + "+l+";\n",r.isValidName(v)&&(a+="} else if (typeof "+v+' === "function") {\n',l=r.wrapMethod("",{name:v,args:y}),a+='  _output = (typeof _output === "undefined") ? '+l+": _output + "+l+";\n"),a+="} else {\n",a+=r.setVar("__"+v,s),a+='  _output = (typeof _output === "undefined") ? __'+v+": _output + __"+v+";\n",a+="}\n");if(s.type!==o)return;if(s.name==="block"){c=s.args[0];if(!i.blocks.hasOwnProperty(c))throw new Error('Unrecognized nested block.  Block "'+c+'" at line '+s.line+' of "'+i.id+'" is not in template block list.');a+=m.call(i.blocks[s.args[0]],t+"  ",n,i)}else if(s.name==="parent"){h=d(s);if(!h)throw new Error("No parent block found for parent tag at line "+s.line+".");a+=m.call(h,t+"  ",n)}else s.hasOwnProperty("compile")?(s.strip.start&&s.tokens.length&&typeof s.tokens[0]=="string"&&(s.tokens[0]=s.tokens[0].replace(/^\s+/,"")),s.strip.end&&s.tokens.length&&typeof _.last(s.tokens)=="string"&&(s.tokens[s.tokens.length-1]=_.last(s.tokens).replace(/\s+$/,"")),a+=s.compile(t+"  ",e)):a+=m.call(s,t+"  ",n)},this),a)}}(i),s.autoescape=function(){return module={},module.exports=function(e,t){return t.compile.apply(this,[e])},module.exports.ends=!0,module.exports}(),s.block=function(){return module={},module.exports={ends:!0},module.exports}(),s["else"]=function(){return module={},module.exports=function(e,t){var n=_.last(this.parent).name,i=_.clone(this.args),s,o,u;if(n==="for"){if(i.length)throw new Error('"else" tag cannot accept arguments in the "for" context.');return"} if (__loopLength === 0) {\n"}if(n!=="if")throw new Error('Cannot call else tag outside of "if" or "for" context.');return s=i.shift(),o=r.parseIfArgs(i,t),u="",s?(u+="} else if (\n",u+="  (function () {\n",_.each(o,function(e){e.hasOwnProperty("preout")&&e.preout&&(u+=e.preout+"\n")}),u+="return (\n",_.each(o,function(e){u+=e.value+" "}),u+=");\n",u+="  })()\n",u+=") {\n",u):e+"\n} else {\n"},module.exports}(),s["extends"]=function(){return module={},module.exports={},module.exports}(),s.filter=function(){return module={},module.exports=function(e,t){var n=_.clone(this.args),i=n.shift(),s=n.length?n.join(", "):"",o="(function () {\n";return o+='  var _output = "";\n',o+=t.compile.apply(this,[e+"  "])+"\n",o+="  return _output;\n",o+="})()\n","_output += "+r.wrapFilter(o.replace(/\n/g,""),{name:i,args:s})+";\n"},module.exports.ends=!0,module.exports}(),s["for"]=function(){return module={},module.exports=function(e,t){var n=_.clone(this.args),i=n[0],s=n[1],o=t.parseVariable(n[2]),u="",a;e=e||"";if(typeof s!="undefined"&&s!=="in")throw new Error('Invalid syntax in "for" tag');if(!r.isValidShortName(i))throw new Error("Invalid arguments ("+i+') passed to "for" tag');if(!r.isValidName(o.name))throw new Error("Invalid arguments ("+o.name+') passed to "for" tag');return i=r.escapeVarName(i),a='loop.index = __loopIndex + 1;\nloop.index0 = __loopIndex;\nloop.revindex = __loopLength - loop.index0;\nloop.revindex0 = loop.revindex - 1;\nloop.first = (__loopIndex === 0);\nloop.last = (__loopIndex === __loopLength - 1);\n_context["'+i+'"] = __loopIter[loop.key];\n'+t.compile.apply(this,[e+"   "]),u='(function () {\n  var loop = {}, __loopKey, __loopIndex = 0, __loopLength = 0, __keys = [],    __ctx_operand = _context["'+i+'"],\n'+"    loop_cycle = function() {\n"+"      var args = _.toArray(arguments), i = loop.index0 % args.length;\n"+"      return args[i];\n"+"    };\n"+r.setVar("__loopIter",o)+"  else {\n"+"    return;\n"+"  }\n"+"  if (_.isArray(__loopIter)) {\n"+"    __loopIndex = 0; __loopLength = __loopIter.length;\n"+"    for (; __loopIndex < __loopLength; __loopIndex += 1) {\n"+"       loop.key = __loopIndex;\n"+a+"    }\n"+'  } else if (typeof __loopIter === "object") {\n'+"    __keys = _.keys(__loopIter);\n"+"    __loopLength = __keys.length;\n"+"    __loopIndex = 0;\n"+"    for (; __loopIndex < __loopLength; __loopIndex += 1) {\n"+"       loop.key = __keys[__loopIndex];\n"+a+"    }\n"+"  }\n"+'  _context["'+i+'"] = __ctx_operand;\n'+"})();\n",u},module.exports.ends=!0,module.exports}(),s["if"]=function(){return module={},module.exports=function(e,t){var n=_.clone(this.args),i=r.parseIfArgs(n,t),s="(function () {\n";return _.each(i,function(e){e.hasOwnProperty("preout")&&e.preout&&(s+=e.preout+"\n")}),s+="\nif (\n",_.each(i,function(e){s+=e.value+" "}),s+=") {\n",s+=t.compile.apply(this,[e+"  "]),s+="\n}\n",s+="})();\n",s},module.exports.ends=!0,module.exports}(),s["import"]=function(){return module={},module.exports=function(e,t){this.args.length!==3;var n=_.clone(this.args),i=n[0],s=n[1],o=n[2],u="";if(!r.isLiteral(i)&&!r.isValidName(i))throw new Error('Invalid attempt to import "'+i+'".');if(s!=="as")throw new Error('Invalid syntax {% import "'+i+'" '+s+" "+o+" %}");return u+="_.extend(_context, (function () {\n",u+='var _context = {}, __ctx = {}, _output = "";\n'+r.setVar("__template",t.parseVariable(i))+"_this.compileFile(__template).render(__ctx, _parents);\n"+"_.each(__ctx, function (item, key) {\n"+'  if (typeof item === "function") {\n'+'    _context["'+o+'_" + key] = item;\n'+"  }\n"+"});\n"+"return _context;\n",u+="})());\n",u},module.exports}(),s.include=function(){return module={},module.exports=function(e,t){var n=_.clone(this.args),i=n.shift(),s="_context",o=!1,u="",a;e=e||"";if(!r.isLiteral(i)&&!r.isValidName(i))throw new Error("Invalid arguments passed to 'include' tag.");if(n.length){_.last(n)==="only"&&(s="{}",n.pop()),n.length>1&&n[0]==="ignore"&n[1]==="missing"&&(n.shift(),n.shift(),o=!0);if(n.length&&n[0]!=="with")throw new Error("Invalid arguments passed to 'include' tag.");if(n[0]==="with"){n.shift();if(!n.length)throw new Error("Context for 'include' tag not provided, but expected after 'with' token.");a=n.shift(),s='_context["'+a+'"] || '+a}}return u="(function () {\n"+r.setVar("__template",t.parseVariable(i))+"\n"+"  var includeContext = "+s+";\n",o&&(u+="try {\n"),u+='  if (typeof __template === "string") {\n',u+="    _output += _this.compileFile(__template).render(includeContext, _parents);\n",u+="  }\n",o&&(u+="} catch (e) {}\n"),u+="})();\n",u},module.exports}(),s.macro=function(){return module={},module.exports=function(e,t){var n=_.clone(this.args),r=n.shift(),i="",s="";return n.length&&(i=JSON.stringify(n).replace(/^\[|\'|\"|\]$/g,"")),s+="_context."+r+" = function ("+i+") {\n",s+='  var _output = "";\n',s+=t.compile.apply(this,[e+"  "]),s+="  return _output;\n",s+="};\n",s},module.exports.ends=!0,module.exports}(),s.parent=function(){return module={},module.exports={},module.exports}(),s.raw=function(){return module={},module.exports={ends:!0},module.exports}(),s.set=function(){return module={},module.exports=function(e,t){var n=_.clone(this.args),i=r.escapeVarName(n.shift(),"_context"),s;if(n.shift()!=="=")throw new Error('Invalid token "'+n[1]+'" in {% set '+n[0]+' %}. Missing "=".');return s=n[0],r.isLiteral(s)||/^\{|^\[/.test(s)||s==="true"||s==="false"?" "+i+" = "+s+";":(s=t.parseVariable(s)," "+i+" = "+"(function () {\n"+"  var _output;\n"+t.compile.apply({tokens:[s]},[e])+"\n"+"  return _output;\n"+"})();\n")},module.exports}(),e}();